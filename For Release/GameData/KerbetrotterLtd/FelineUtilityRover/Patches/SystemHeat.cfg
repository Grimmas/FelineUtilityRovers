// this patch config is mostly copied from Nertea's existing
// Squad patches and adapted slightly for Lynx parts

// SystemHeatHaversters provides a generic config but this is
// a more balanced match (hopefully)
@PART[Lynx_DrillRear]:FOR[FelineUtilityRover]:NEEDS[SystemHeat]
{
  !MODULE[ModuleCoreHeat] {}
  !MODULE[ModuleOverheatDisplay] {}

  MODULE
  {
    name = ModuleSystemHeat
    // Cubic metres
    volume = 0.4
    moduleID = harvester
    iconName = Icon_Drill
  }

  @MODULE[ModuleResourceHarvester]
  {
    @name = ModuleSystemHeatHarvester
    // must be unique
    moduleID = harvester
    // ModuleSystemHeat moduleID to link to
    systemHeatModuleID = harvester

    // The shutdown temperature of the part
    shutdownTemperature = 750

    // The temperature the system contributes to loops
    systemOutletTemperature = 400

    // Map loop temperature to system efficiency (0-1.0)
    systemEfficiency
    {
        key = 0 1.0
        key = 400 1.0
        key = 600 0.0
    }
    
    // Heat generation (kW)
    systemPower = 30
    
    !ThermalEfficiency  {} 
    !TemperatureModifier {}
    
	// disable stock heating
    @GeneratesHeat = false 
  }
}

// SystemHeatConverters provides a generic config but this is
// a more balanced match (hopefully)
@PART[Lynx_ISRU]:FOR[FelineUtilityRover]:NEEDS[SystemHeat]
{
  !MODULE[ModuleCoreHeat] {}

  MODULE
  {
    name = ModuleSystemHeat
    // Cubic metres
    volume = 1.25
    moduleID = isru
    iconName = Icon_Gears
  }

  !MODULE[ModuleOverheatDisplay] {}

  // LF only converter
  @MODULE[ModuleResourceConverter]:HAS[@OUTPUT_RESOURCE:HAS[#ResourceName[LiquidFuel]],!OUTPUT_RESOURCE:HAS[#ResourceName[Oxidizer]]]
  {
    @name = ModuleSystemHeatConverter
    // must be unique
    moduleID = converter1
    // ModuleSystemHeat moduleID to link to
    systemHeatModuleID = isru

    // The shutdown temperature of the part
    shutdownTemperature = 800

    // The temperature the system contributes to loops
    systemOutletTemperature = 500

    // Map loop temperature to system efficiency (0-1.0)
    systemEfficiency
    {
        key = 0 0.0
        key = 400 1.0
        key = 600 1.0
        key = 800 0.0
    }
    // Heat generation (kW)
    systemPower = 20 

    @UseSpecialistBonus = true
    @SpecialistEfficiencyFactor = 0.2
    @SpecialistBonusBase = 0.05
    @UseSpecialistHeatBonus = true
    @SpecialistHeatFactor = 0.1
    @ExperienceEffect = ConverterSkill
    @EfficiencyBonus = 1

    !ThermalEfficiency  {} 
    !TemperatureModifier {}
    
	// disable stock heating
    @GeneratesHeat = false
  }
  // LFO converter
  @MODULE[ModuleResourceConverter]:HAS[@OUTPUT_RESOURCE:HAS[#ResourceName[LiquidFuel]],@OUTPUT_RESOURCE:HAS[#ResourceName[Oxidizer]]]
  {
    @name = ModuleSystemHeatConverter
    // must be unique
    moduleID = converter2
    // ModuleSystemHeat moduleID to link to
    systemHeatModuleID = isru

    // The shutdown temperature of the part
    shutdownTemperature = 800

    // The temperature the system contributes to loops
    systemOutletTemperature = 500

    // Map loop temperature to system efficiency (0-1.0)
    systemEfficiency
    {
        key = 0 0.0
        key = 400 1.0
        key = 600 1.0
        key = 800 0.0
    }
    // Heat generation (kW)
    systemPower = 20 
	
	@UseSpecialistBonus = true
    @SpecialistEfficiencyFactor = 0.2
    @SpecialistBonusBase = 0.05
    @UseSpecialistHeatBonus = true
    @SpecialistHeatFactor = 0.1
    @ExperienceEffect = ConverterSkill
    @EfficiencyBonus = 1
    
    !ThermalEfficiency  {} 
    !TemperatureModifier {}
        
	// disable stock heating
    @GeneratesHeat = false
  }
  // Ox only
  @MODULE[ModuleResourceConverter]:HAS[!OUTPUT_RESOURCE:HAS[#ResourceName[LiquidFuel]],@OUTPUT_RESOURCE:HAS[#ResourceName[Oxidizer]]]
  {
    @name = ModuleSystemHeatConverter
    // must be unique
    moduleID = converter3
    // ModuleSystemHeat moduleID to link to
    systemHeatModuleID = isru

    // The shutdown temperature of the part
    shutdownTemperature = 800

    // The temperature the system contributes to loops
    systemOutletTemperature = 500

    // Map loop temperature to system efficiency (0-1.0)
    systemEfficiency
    {
        key = 0 0.0
        key = 400 1.0
        key = 600 1.0
        key = 800 0.0
    }
    // Heat generation (kW)
    systemPower = 20 
	
	@UseSpecialistBonus = true
    @SpecialistEfficiencyFactor = 0.2
    @SpecialistBonusBase = 0.05
    @UseSpecialistHeatBonus = true
    @SpecialistHeatFactor = 0.1
    @ExperienceEffect = ConverterSkill
    @EfficiencyBonus = 1

    !ThermalEfficiency  {} 
    !TemperatureModifier {}
	
	// disable stock heating
    @GeneratesHeat = false
  }

  // Mono
  @MODULE[ModuleResourceConverter]:HAS[@OUTPUT_RESOURCE:HAS[#ResourceName[MonoPropellant]]]
  {
    @name = ModuleSystemHeatConverter
    // must be unique
    moduleID = converter4
    // ModuleSystemHeat moduleID to link to
    systemHeatModuleID = isru

    // The shutdown temperature of the part
    shutdownTemperature = 800

    // The temperature the system contributes to loops
    systemOutletTemperature = 500

    // Map loop temperature to system efficiency (0-1.0)
    systemEfficiency
    {
        key = 0 0.0
        key = 400 1.0
        key = 600 1.0
        key = 800 0.0
    }
    // Heat generation (kW)
    systemPower = 20 

    @UseSpecialistBonus = true
    @SpecialistEfficiencyFactor = 0.2
    @SpecialistBonusBase = 0.05
    @UseSpecialistHeatBonus = true
    @SpecialistHeatFactor = 0.1
    @ExperienceEffect = ConverterSkill
    @EfficiencyBonus = 1
    
    !ThermalEfficiency  {} 
    !TemperatureModifier {}      
	
	// disable stock heating
    @GeneratesHeat = false
  }
}

@PART[Lynx_Radiator]:FOR[FelineUtilityRover]:NEEDS[SystemHeat]
{
  MODULE
  {
    name = ModuleSystemHeat
    volume = 0.02
    moduleID = default
    iconName = Icon_Radiator
  }
  
  @MODULE[ModuleActiveRadiator]
  {
    @name = ModuleSystemHeatRadiator
    moduleID = radiator
    // ModuleSystemHeat instance to link to
    systemHeatModuleID = default
    scalarModuleID = heat
    maxTempAnimation = 500


    // Power radiated per temperature
    temperatureCurve
    {
      key = 0 0
      key = 350 50
    }

    // area for convection
    convectiveArea = 3
  }
  
  MODULE
  {
    name = ModuleSystemHeatColorAnimator
    moduleID = heat
    useRate = false
    animRate = 1
    shaderProperty = _EmissiveColor
    toggleInEditor = false
    toggleInFlight = false
    redCurve
    {
      key = 0 1
      key = 1 1
    }
    greenCurve
    {
      key = 0 1
      key = 1 1
    }
    blueCurve
    {
      key = 0 1
      key = 1 1
    }
    alphaCurve
    {
      key = 0 0
      key = 1 1
    }
  }

}